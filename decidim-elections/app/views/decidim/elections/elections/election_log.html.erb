<% content_for :css_content do %>
  <%= stylesheet_pack_tag "decidim_elections", media: "all" %>
<% end %>

<% content_for :js_content do %>
  <%= javascript_pack_tag "decidim_elections" %>
<% end %>

<%= render layout: "layouts/decidim/shared/layout_center" do %>

  <% scope = "decidim.elections.elections.election_log" %>

  <div class="text-center py-10">
    <h1 class="h3 md:h1 decorator inline-block text-left mb-12">
      <%= t("title", scope:) %>
    </h1>

    <div class="text-lg text-gray-2 text-left">
      <%= t("description", scope:) %>
    </div>
  </div>

  <div id="election-log"
    data-election-id="<%= election.id %>"
    data-api-endpoint-url="<%= bulletin_board_server %>"
    data-authority-slug="<%= authority_slug %>"
    data-authority-public-key="<%= authority_public_key %>">

    <!-- CREATE ELECTION STEP -->
    <div id="create-election-step" class="election-log__entry">
      <span class="election-log__time" data-time></span>

      <h2 class="h4 text-secondary">
        <%= t("creation_title", scope:) %>
        <span data-no-election-created><span class="label"><%= t("not_created", scope:) %></span></span>
        <span data-election-created hidden><span class="label success"><%= t("complete", scope:) %></span></span>
      </h2>

      <span data-no-election-created>
        <%= t("creation_description.not_created", scope:) %>
      </span>
      <span data-election-created hidden>
        <%= t("creation_description.complete", scope:) %>
      </span>

      <span class="election-log__hash"><strong><%= t("chained_hash", scope:) %></strong> <span data-chained-hash></span></span>
    </div>

    <!-- KEY CEREMONY STEP -->
    <div id="key-ceremony-step" class="election-log__entry">
      <span class="election-log__time" data-time></span>

      <h2 class="h4 text-secondary">
        <%= t("key_ceremony_title", scope:) %>
        <span data-key-ceremony-not-started><span class="label"><%= t("not_started", scope:) %></span></span>
        <span data-key-ceremony-started hidden><span class="label warning"><%= t("started", scope:) %></span></span>
        <span data-key-ceremony-completed hidden><span class="label success"><%= t("complete", scope:) %></span></span>
      </h2>

      <span data-key-ceremony-not-started>
        <%= t("key_ceremony_description.not_started", scope:) %>
      </span>
      <span data-key-ceremony-started hidden>
        <%= t("key_ceremony_description.started", scope:) %>
      </span>
      <span data-key-ceremony-completed hidden>
        <%= t("key_ceremony_description.complete", scope:) %>
      </span>

      <span class="election-log__hash"><strong><%= t("chained_hash", scope:) %></strong> <span data-chained-hash></span></span>
    </div>

    <!-- VOTE STEP -->
    <div id="vote-step" class="election-log__entry">
      <span class="election-log__time" data-time></span>

      <h2 class="h4 text-secondary">
        <%= t("vote_title", scope:) %>
        <span data-vote-not-started><span class="label"><%= t("not_started", scope:) %></span></span>
        <span data-vote-started hidden><span class="label success"><%= t("started", scope:) %></span></span>
        <span data-vote-completed hidden><span class="label success"><%= t("complete", scope:) %></span></span>
      </h2>

      <span data-vote-not-started>
        <%= t("vote_description.not_started", scope:) %>
      </span>
      <span data-vote-started hidden>
        <%= t("vote_description.started", scope:) %>
      </span>
      <span data-vote-completed hidden>
        <%= t("vote_description.finished", scope:) %>
      </span>

      <span class="election-log__hash"><strong><%= t("chained_hash", scope:) %></strong> <span data-chained-hash></span></span>
    </div>

    <!-- TALLY STEP -->
    <div id="tally-step" class="election-log__entry">
      <span class="election-log__time" data-time></span>

      <h2 class="h4 text-secondary">
        <%= t("tally_title", scope:) %>
        <span data-tally-not-started><span class="label"><%= t("not_started", scope:) %></span></span>
        <span data-tally-started hidden><span class="label success"><%= t("started", scope:) %></span></span>
        <span data-tally-completed hidden><span class="label success"><%= t("complete", scope:) %></span></span>
      </h2>

      <span data-tally-not-started>
        <%= t("tally_description.not_started", scope:) %>
      </span>
      <span data-tally-started hidden>
        <%= t("tally_description.started", scope:) %>
      </span>
      <span data-tally-completed hidden>
        <%= t("tally_description.finished", scope:) %>
      </span>

      <span class="election-log__hash"><strong><%= t("chained_hash", scope:) %></strong> <span data-chained-hash></span></span>
    </div>

    <!-- PUBLISHED RESULTS STEP -->
    <div id="results-step" class="election-log__entry">
      <span class="election-log__time" data-time></span>

      <h2 class="h4 text-secondary">
        <%= t("results_title", scope:) %>
        <span data-results-not-published><span class="label"><%= t("not_published", scope:) %></span></span>
        <span data-results-published hidden><span class="label success"><%= t("published", scope:) %></span></span>
      </h2>

      <span data-results-not-published>
        <%= t("results_description.not_published", scope:) %>
      </span>
      <span data-results-published hidden>
        <%= t("results_description.published", scope:) %>
      </span>

      <span class="election-log__hash"><strong><%= t("chained_hash", scope:) %></strong> <span data-chained-hash></span></span>
    </div>

    <%# REDESIGN_PENDING: This block does not look like to be in use %>
    <!-- VERIFIABLE RESULTS STEP -->
    <div id="verifiable-results-step" class="election-log__entry">
      <h2 class="h4 text-secondary">
        <%= t("verifiable_results.title", scope:) %>
        <% if election.results_published? %>
          <span class="label success"><%= t("verify", scope:) %></span>
        <% else %>
          <span class="label"><%= t("not_ready", scope:) %></span>
        <% end %>
      </h2>

      <% if election.results_published? %>
        <%= content_tag :p, sanitize(t("verifiable_results.description.ready", scope:)) %>
        <pre class="election-log__pre">sha256sum &lt;verifiable_election_file_path&gt;</pre>
        <%= content_tag :p, sanitize(t("verifiable_results.how_to_verify", scope:)) %>
        <pre class="election-log__pre">bin/verify &lt;verifiable_election_file_path&gt;</pre>
      <% else %>
        <span><%= t("verifiable_results.description.not_ready", scope:) %></span>
      <% end %>

      <% if election.results_published? %>
        <span class="election-log__hash">
          <strong><%= t("verifiable_results.verifiable_file", scope:) %></strong>
          <% if election.verifiable_results_file_url.present? %>
            <%= link_to t("download", scope:), election.verifiable_results_file_url, class: "card__button button small" %>
          <% else %>
            <span><%= t("not_available", scope:) %></span>
          <% end %>
        </span>

        <span class="election-log__hash">
          <strong><%= t("verifiable_results.checksum", scope:) %></strong>
          <% if election.verifiable_results_file_hash.present? %>
            <%= election.verifiable_results_file_hash %>
          <% else %>
            <span><%= t("not_available", scope:) %></span>
          <% end %>
        </span>
      <% end %>
    </div>
  </div>

<%= append_javascript_pack_tag "decidim_elections" %>
