<% add_decidim_meta_tags({
  image_url: current_participatory_space.attached_uploader(:hero_image).path,
  description: translated_attribute(current_participatory_space.short_description),
  url: conference_url(current_participatory_space),
  twitter_handler: current_organization.twitter_handler
}) %>

<%
edit_link(
  resource_locator(current_participatory_space).edit,
  :update,
  :conference,
  conference: current_participatory_space
)
%>

<%# NOTE: This page is wrapped within a main tag, in order to
    include the hero inside the two-column layout.
    Therefore is mandatory to pass the "main_enabled: false" flag
    to the layout_two_col for disabling the original main. %>
<main>

  <%= content_for :aside do %>
    <div class="conference__nav-container">
      <button id="dropdown-trigger" data-component="dropdown" data-target="dropdown-menu" data-auto-close="true">
        <span><%= t("decidim.searches.filters.jump_to") %></span>
        <%= icon "arrow-down-s-line" %>
        <%= icon "arrow-up-s-line" %>
      </button>
      <ul id="dropdown-menu" class="conference__nav" aria-hidden="true">
        <%= render partial: "layouts/decidim/conferences/conference_nav_item", collection: conference_nav_items, as: :item %>
      </ul>
    </div>
  <% end %>

  <%= render partial: "conference_hero" %>

  <%= render layout:"layouts/decidim/shared/layout_two_col", locals: { reverse: true, main_enabled: false } do %>

    <%# REDESIGN_PENDING: Uncomment after https://github.com/decidim/decidim/pull/10005 and remove the old one %>
    <%#= redesigned_participatory_space_floating_help %>
    <%= participatory_space_floating_help %>

    <section class="content-block">
      <h2 class="h2 decorator"><%= t("conferences.show.introduction", scope: "decidim") %></h2>
      <div class="content-block__description">
        <%= decidim_sanitize_editor_admin translated_attribute(current_participatory_space.short_description) %>
      </div>
    </section>

    <section class="content-block conference__content-block">
      <h2 class="h2 decorator"><%= t("conferences.show.details", scope: "decidim") %></h2>
      <div class="content-block__description">
        <%= decidim_sanitize_editor_admin translated_attribute(current_participatory_space.description) %>
      </div>

      <div>
        <% if current_participatory_space.registrations_enabled? %>
          <%= link_to t("decidim.conferences.conferences.show.register"), decidim_conferences.conference_registration_types_path(current_participatory_space), class:"button button__lg button__secondary" %>
        <% end %>
        <% current_participatory_space.components.where(manifest_name: "meetings").each do |component_meeting| %>
          <% if component_meeting.published? || component_meeting == self.try(:current_component) %>
            <%= link_to translated_attribute(component_meeting.name), decidim_conferences.conference_conference_program_path(current_participatory_space, id: component_meeting.id), class:"button button__lg button__transparent-secondary" %>
          <% end %>
        <% end %>
      </div>
    </section>

    <%= render partial: "partners", locals: { conference: current_participatory_space } %>

    <% unless translated_attribute(current_participatory_space.objectives).blank? %>
      <section class="content-block">
        <h2 class="h2 decorator"><%= t("decidim.conferences.show.objectives") %></h2>
        <div class="content-block__description">
          <%= decidim_sanitize_editor_admin translated_attribute(current_participatory_space.objectives) %>
        </div>
      </section>
    <% end %>

    <%= render_hook(:conference_venues) %>

    <% if current_participatory_space.registrations_enabled? %>
      <section class="content-block">
        <h2 class="h2 decorator"><%= t("decidim.conferences.conferences.show.register") %></h2>
        <% if current_user.present? %>
          <div class="conference__box">
            <div>
              <%= icon "user-follow-line", class: "conference__box-icon" %>
              <p class="conference__box-title"><%= t("decidim.conferences.conferences.show.make_conference_registration") %></p>
              <p class="conference__box-description"><%= t("decidim.conferences.conferences.show.login_as", name: current_user.name, email: current_user.email ) %></p>
            </div>
            <div>
              <%= link_to t("decidim.conferences.conferences.show.register"), decidim_conferences.conference_registration_types_path(current_participatory_space), class:"button button__lg button__secondary" %>
            </div>
          </div>
        <% else %>
          <%= render partial: "decidim/devise/shared/login_boxes" %>
        <% end %>
      </section>
    <% end %>

    <%= cell("decidim/conferences/linked_participatory_spaces", current_participatory_space) %>

    <% if current_participatory_space.show_statistics? %>
      <%= cell("decidim/statistics", stats.highlighted) %>
    <% end %>

  <% end %>
</main>
