<% if Decidim::Initiatives.creation_enabled %>
  <% if current_user && available_initiative_types.size > 1 %>
    <%= link_to create_initiative_path(:select_initiative_type), class: "title-action__action button button__xl button__secondary w-full" do %>
      <%= icon "add-fill" %>
      <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
    <% end %>
  <% elsif current_user %>
    <% if allowed_to?(:create, :initiative, { initiative_type: available_initiative_types.first }) %>
      <%= link_to create_initiative_path(:select_initiative_type), class: "title-action__action button button__xl button__secondary w-full" do %>
        <%= icon "add-fill" %>
        <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
      <% end %>
    <% else %>
      <%= authorized_create_modal_button(available_initiative_types.first, remote: true, class: "title-action__action button button__xl button__secondary w-full") do %>
        <%= icon "add-fill" %>
        <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
      <% end %>
    <% end %>
  <% else %>
    <% content_for(:redirect_after_login) { create_initiative_url(:select_initiative_type) } %>
    <button type="button" class="title-action__action button button__xl button__secondary w-full" data-dialog-open="loginModal" aria-controls="loginModal" aria-haspopup="dialog" tabindex="0">
      <%= icon "add-fill" %>
      <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
    </button>
  <% end %>
<% end %>

<%= render partial: "decidim/initiatives/modal" %>
