<%
@title = "Search results -- Decidim Barcelona"
%>

<%= partial "template_top" %>

<main>
  <div class="wrapper">
    <%= partial "input_search" %>
    <div class="row">
      <div class="columns mediumlarge-4 large-3">
        <%= partial "filters_general" %>
      </div>
      <div class="columns mediumlarge-8 large-9">
        <h2 class="section-heading">Iniciatives&nbsp;<span class="muted"><%= Faker::Number.between(from: 0, to: 100) %> results</span></h2>
        <div class="row small-up-1 medium-up-2 mediumlarge-up-1 large-up-2 card-grid">
          <% 4.times do %>
          <div class="column">
            <article class="card card--initiative success">
              <div class="card__content">
                <div class="card__header">
                  <%= link_to page_path("proposal-view"), class: "card__link" do %>
                  <h5 class="card__title">
                    <%= Faker::Movies::StarWars.quote[0..75] %>
                  </h5>
                  <% end %>
                  <div class="card__author">
                    <!-- locals.text: the number has to match with the hidden ones -->
                    <!-- locals.size: classname. small shows only 3 items -->
                    <!-- locals.classText: classname. default text-small. append to span -->
                    <%= render layout: "public/components/collapsible-list", locals: { text: raw("y <strong>6</strong> personas más"), size: 3, classText: "" } do %>
                    <% 12.times do %>
                    <%= partial "author_data", { nick: false } %>
                    <% end %>
                    <% end %>
                  </div>
                </div>
                <div class="card__text">
                  <div class="card__text--paragraph">
                    <span class="card__text--status success">aceptada</span><%= Faker::Hipster.paragraph[0..140] %>
                  </div>
                </div>
                <ul class="tags tags--proposal">
                  <li>
                    <a href="#">
                      El Raval
                    </a>
                  </li>
                  <li>
                    <a href="#">Transició ecològica</a>
                  </li>
                </ul>
              </div>
              <div class="card__status">
                <ul class="card-data">
                  <li class="card-data__item">
                    <%= Faker::Date.backward(725).strftime("%d/%m/%Y") %>
                  </li>
                  <li class="card-data__item">
                    <a href="">
                      <%= icon "bell", class: "icon--small", aria_label: "Respaldos", role: "img" %>&nbsp;Follow
                    </a>
                  </li>
                  <li class="card-data__item">
                    <a href="">
                      <%= icon "bullhorn", class: "icon--small", aria_label: "Respaldos", role: "img" %>
                      <%= Faker::Number.between(from: 0, to: 100) %>
                    </a>
                  </li>
                  <li class="card-data__item">
                    <a href="" title="Comentarios">
                      <%= icon "comment-square", class: "icon--small", aria_label: "Comentarios", role: "img" %>
                      <%= Faker::Number.between(from: 0, to: 100) %>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="card__footer">
                <div class="card__support">
                  <%= partial "progress_bar", { progress: Faker::Number.between(from: 0, to: 100), text: "Firmas" } %>

                  <button class="card__button button secondary button--sc small light">
                    Firmar
                  </button>
                </div>
              </div>
            </article>
          </div>
          <% end %>
        </div>
        <div class="row collapse">
          <%= link_to "View all initiatives (" + Faker::Number.between(from: 0, to: 100).to_s + ")", page_path("initiatives/initiatives"), class: "button secondary light pull-right" %>
        </div>

        <hr class="reset mb-m mt-sm">
        <h2 class="section-heading">Proposals&nbsp;<span class="muted"><%= Faker::Number.between(from: 0, to: 100) %> results</span></h2>
        <div class="row small-up-1 medium-up-2 mediumlarge-up-1 large-up-2 card-grid">
          <% 2.times do %>
          <div class="column">
            <article class="card card--proposal success">
              <div class="card__top">
                <div class="card__content text-small">
                  <span class="muted">Proceso:</span>&nbsp;<%= link_to Faker::Hipster.sentence, page_path("info"), class: "card__link text-ellipsis" %>
                </div>
              </div>
              <div class="card__content">
                <div class="card__header">
                  <%= link_to page_path("proposal-view"), class: "card__link" do %>
                    <h5 class="card__title">
                      <%= Faker::Movies::StarWars.quote[0..75] %>
                    </h5>
                  <% end %>
                  <div class="card__author">
                    <%= partial "author_data", { nick: false } %>
                  </div>
                </div>
                <div class="card__text">
                  <div class="card__text--paragraph">
                    <span class="card__text--status success">aceptada</span><%= Faker::Hipster.paragraph[0..140] %>
                  </div>
                </div>
                <ul class="tags tags--proposal">
                  <li>
                    <a href="#">
                      El Raval
                    </a>
                  </li>
                  <li>
                    <a href="#">Transició ecològica</a>
                  </li>
                </ul>
              </div>
              <div class="card__status">
                <ul class="card-data">
                  <li class="card-data__item">
                    <%= Faker::Date.backward(725).strftime("%d/%m/%Y") %>
                  </li>
                  <li class="card-data__item">
                    <a href="">
                      <%= icon "bell", class: "icon--small", aria_label: "Respaldos", role: "img" %>&nbsp;Follow
                    </a>
                  </li>
                  <li class="card-data__item">
                    <a href="">
                      <%= icon "bullhorn", class: "icon--small", aria_label: "Respaldos", role: "img" %>
                      <%= Faker::Number.between(from: 0, to: 100) %>
                    </a>
                  </li>
                  <li class="card-data__item">
                    <a href="" title="Comentarios">
                      <%= icon "comment-square", class: "icon--small", aria_label: "Comentarios", role: "img" %>
                      <%= Faker::Number.between(from: 0, to: 100) %>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="card__footer">
                <div class="card__support">
                  <%= partial "progress_bar", { progress: Faker::Number.between(from: 0, to: 100), total: 100 } %>

                  <button class="card__button button button--sc small">
                    Apoyar
                  </button>
                </div>
              </div>
            </article>
          </div>
          <% end %>
        </div>

        <hr class="reset mb-m mt-sm">
        <h2 class="section-heading">Users&nbsp;<span class="muted"><%= Faker::Number.between(from: 0, to: 100) %> results</span></h2>
        <div class="row small-up-1 medium-up-2 mediumlarge-up-1 large-up-2 card-grid">
          <% 2.times do %>
          <div class="column">
            <article class="card card--member">
              <div class="card__content">
                <div class="card__header collapse">
                  <%= partial "author_data", { big: true, verified: false, nick: Faker::Boolean.boolean } %>
                </div>
                <div class="card__text card--picture-offset">
                  <div><small><strong><%= Faker::Company.profession.capitalize %></strong></small></div>
                  <div><small><%= Faker::Movies::StarWars.vehicle %></small></div>
                  <div class="text-small">Designated on <strong><%= Faker::Date.backward(365).strftime("%D") %></strong></div>
                  <div class="text-small mt-s"><%= Faker::Demographic.sex %> / <%= Faker::Number.number(digits: 2) %> / <%= Faker::Address.city %></div>
                </div>
              </div>
            </article>
          </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</main>

<%= partial "template_bottom" %>

<%# Only for demo purposes %>
<script>
window.addEventListener("load", function(event) {
  $("#input-search").on("input", function (event) {
    const pattern = event.target.value
    const $contents = $("article.card")

    // Remove previous
    $contents.find("span.bg-warning").contents().unwrap()

    if (pattern.length > 2) {
      $contents.each((id, container) => {
        const text = container.innerText
        const indexText = text.toLowerCase().indexOf(pattern.toLowerCase())

        // Search only in text
        if (indexText !== -1) {
          const content = container.innerHTML
          const index = content.toLowerCase().indexOf(pattern.toLowerCase())

          container.innerHTML = `${content.substring(0, index)}<span class='bg-warning'>${content.substring(index, index + pattern.length)}</span>${content.substring(index + pattern.length)}`
        }
      })
    }
  })
});
</script>
