$(() => {
  var rootCommentableId = <%== "comments-for-#{@commentable.class.name.demodulize}-#{@commentable.id}".to_json %>;
  var $comments = $("#" + rootCommentableId);
  var config = $comments.data("decidim-comments");

  component = new Decidim.CommentsComponent($comments, config);
  component.unmountComponent();

  var commentHtml = '<%== j(render partial: "edited_comment", locals: { comment: @comment }).strip %>';
  var commentId = <%= @comment.id.to_json %>;
  var $comment = $("#comment_<%= @comment.id %>");

  $comment.replaceWith(commentHtml);

  $comments.foundation();

  // Re-create the component
  component = new Decidim.CommentsComponent($comments, $comments.data("decidim-comments"));
  component.mountComponent();
  $comments.data("comments", component);

  // Trigger ajax:success event to apply behaviour on the
  // edited comment
  Rails.fire(document, "ajax:success", {
    commentsIds: [commentId]
  });
});
