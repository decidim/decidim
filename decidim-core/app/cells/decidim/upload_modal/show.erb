<div class="dynamical-uploads upload-container-for-<%= attribute %>">
  <div class="active-attachments">
    <% attachments.each do |attachment| %>
      <% next if attachment.is_a? Array %>
      <div class="attachment-details" data-title="<%= title_for(attachment) %>" data-filename="<%= file_name_for(attachment) %>" data-state="uploaded">
        <%= form.hidden_field attribute, multiple: true, value: attachment.id %>
        <span><%= title_for(attachment) %> <%= file_name_for(attachment) %></span>
      </div>
    <% end %>
  </div>

  <button
    name=<%= attribute %>
    class="<%= button_class %>"
    data-open="<%= modal_id %>"
    data-resourcename="<%= resource_name %>"
    data-multiple="<%= multiple %>"
    data-titled="<%= has_title? %>">
    <%= label %>
  </button>

  <% if !has_title? && !attachments.first.is_a?(Array) %>
    <div class="remove-attachment" id="attachment_<%= attachments.first&.id %>" data-closable>
      <button class="remove-attachment"
            aria-label="<%= t("delete_document", scope: "decidim.proposals.proposals.edit") %>"
            title="<%= t("delete_document", scope: "decidim.proposals.proposals.edit") %>"
            type="button" data-close>
        <span aria-hidden="true">&times; Remove</span>
      </button>
    </div>
  <% end %>
</div>

<!-- MODAL STARTS -->

<div class="reveal attachment-modal" id="<%= modal_id %>" data-reveal>
  <div class="reveal__header">
    <h3 class="reveal__title" data-addlabel="<%= add_label %>" data-editlabel="<%= edit_label %>"><%= label %></h3>
    <button class="close-button" data-close aria-label="<%= "Close modal" %>"
      type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="help">
    <span>Guidance for <%= attribute %></span>
    <ul>
      <% help_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>

  <div class="row dropzone-container" data-name=<%= attribute %>>
    <label class="dropzone">
      <%= form.file_field add_attribute, label: false, multiple: true, direct_upload: true, data: { directuploadurl: "/rails/active_storage/direct_uploads" } %>
      <span>Drop files here or click to upload</span>
    </label>
    <div class="upload-items"></div>
  </div>

  <div class="row columns reveal__content">
    <div class="text-center">
      <button class="button primary add-attachment-<%= attribute %>" data-close><%= "Save" %></button>
      <button class="link cancel-attachment margin-left-1" data-close><%= "Cancel" %></button>
    </div>
  </div>
</div>
