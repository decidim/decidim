  <% if collection.leaf %>
    <% data_sub_checkboxes_id = "#{chained_check_boxes_id}-#{collection.leaf.value}" %>
    <% hide_node = (hide_node.present? and hide_node == "true") ? true : false %>
    <% is_root_check_box = (collection.leaf.value == "") ? true : false %>
    <% if is_root_check_box %>
      <%= hidden_field_tag "#{form.object_name}[#{attribute}][]", "" %>
    <% else %>
      <div class="filters__has-subfilters">
    <% end %>
      <%= form.check_box attribute,
                       chained_check_box_options(
                         collection.leaf.value,
                         collection.leaf.label,
                         {
                           "data-sub-checkboxes": data_sub_checkboxes_id,
                           is_root_check_box: is_root_check_box
                         }),
                         collection.leaf.value.to_s, nil %>

    <% unless is_root_check_box %>
      <% if collection.node.present? %>
        <button type="button" aria-label="show/hide" data-toggle="<%= data_sub_checkboxes_id %> <%= data_sub_checkboxes_id %>-trigger">
          <span id="<%= data_sub_checkboxes_id %>-trigger" data-toggler=".filters__is-open">
            <span class="filters__icon-is-closed" aria-hidden="true"><%= icon "chevron-top" %></span>
            <span class="filters__icon-is-open" aria-hidden="true"><%= icon "chevron-bottom" %></span>
          </span>
        </button>
      <% end %>
      </div>
    <% end %>

    <% if collection.node.present? %>
      <div id="<%= data_sub_checkboxes_id %>" class="filters__subfilters <%= "hide" if hide_node %>" <%= %{data-toggler=.hide} unless is_root_check_box %>>
        <% collection.node.each do |item| %>
          <% if item.tree_node? %>
            <%= render "decidim/shared/chained_check_boxes",
                        form: form,
                        attribute: attribute,
                        collection: item,
                        chained_check_boxes_id: "#{chained_check_boxes_id}-#{item.leaf.value}",
                        hide_node: "true",
                        options: options %>
          <% else %>
            <%= form.check_box attribute,
                                chained_check_box_options(
                                  item.value,
                                  item.label
                                ),
                                item.value, nil %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
