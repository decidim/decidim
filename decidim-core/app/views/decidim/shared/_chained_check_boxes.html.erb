  <% if collection.leaf %>
    <% data_sub_checkboxes_id = "#{chained_check_boxes_id}-#{collection.leaf.value}" %>
    <% is_root_check_box = (collection.leaf.value == "all") ? true : false %>
    <% unless is_root_check_box %>
      <div class="filters__has-subfilters">
    <% end %>
      <%= form.check_box attribute,
                       chained_check_box_options(
                         collection.leaf.value,
                         collection.leaf.label,
                         {
                           "data-sub-checkboxes": data_sub_checkboxes_id
                         }),
                         collection.leaf.value, nil %>

    <% unless is_root_check_box %>
      <% if collection.node.present? %>
        <button type="button" aria-label="show/hide" data-toggle="<%= data_sub_checkboxes_id %> <%= data_sub_checkboxes_id %>-trigger">
          <span id="<%= data_sub_checkboxes_id %>-trigger" data-toggler=".filters__is-open">
            <span class="filters__icon-is-closed" aria-hidden="true"><%= icon "chevron-bottom" %></span>
            <span class="filters__icon-is-open" aria-hidden="true"><%= icon "chevron-top" %></span>
          </span>
        </button>
      <% end %>
      </div>
    <% end %>

    <% if collection.node.present? %>
      <div id="<%= data_sub_checkboxes_id %>" class="filters__subfilters" <%= %{data-toggler=.hide} unless is_root_check_box %>>
        <% collection.node.each do |point| %>
          <% if point.tree_node? %>
            <%= render "decidim/shared/chained_check_boxes",
                        form: form,
                        attribute: attribute,
                        collection: point,
                        chained_check_boxes_id: "#{chained_check_boxes_id}-#{point.leaf.value}",
                        options: options %>
          <% else %>
            <%= form.check_box attribute,
                                chained_check_box_options(
                                  point.value,
                                  point.label
                                ),
                                point.value, nil %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
