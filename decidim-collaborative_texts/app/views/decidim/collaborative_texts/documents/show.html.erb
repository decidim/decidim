<% provide(:title, document.title) %>

<% add_decidim_meta_tags(
  title: document.title,
  url: document_url(document.id),
  resource: document) %>

<%
  edit_link(
    resource_locator(document).edit,
    :update,
    :collaborative_text,
    document:
  )
%>

<%= render layout: "layouts/decidim/shared/layout_center", locals: { columns: 8 } do %>
  <%= render partial: "decidim/shared/component_announcement" %>

  <section class="layout-main__section">
    <div class="flex justify-center">
      <h1 class="title-decorator my-12"><%= document.title %></h1>
    </div>

    <%= cell("decidim/announcement", translated_attribute(document.announcement)) if strip_tags(document.announcement&.values&.join)&.strip.present? %>
    <%= cell("decidim/announcement", t("decidim.collaborative_texts.document.status.draft"), callout_class: "warning") if document.draft? %>
    <%= cell("decidim/announcement", t("decidim.collaborative_texts.document.status.accepting_suggestions")) if document.suggestions_enabled? %>
    <%= cell("decidim/announcement", t("decidim.collaborative_texts.document.status.not_accepting_suggestions")) unless document.suggestions_enabled? || document.draft? %>

    <div class="collaborative-texts-manager hidden">
      <%= button_tag(t("decidim.collaborative_texts.document.rollout.new"), class:"button button__lg button__primary", data: { collaborative_texts_manager_rollout: true }) %>
      <%= button_tag(t("decidim.collaborative_texts.document.consolidate.new"), class:"button button__lg button__transparent-primary", data: { collaborative_texts_manager_consolidate: true }) %>
    </div>

    <div class="collaborative-texts-alert hidden">
      <div></div>
    </div>

    <script type="text/template" class="decidim-template" id="collaborative-texts-editor-template"><%= render "editor_template" %></script>

    <div data-collaborative-texts-document="<%= document.suggestions_enabled? %>"
         data-collaborative-texts-i18n="<%= document_i18n.to_json %>"
         data-collaborative-texts-suggestions-editor-template="#collaborative-texts-editor-template"
         data-collaborative-texts-suggestions-url="<%= document_suggestions_path(document) %>"
         data-collaborative-texts-rollout-url="<%= document_path(document) if allowed_to?(:rollout, :collaborative_text, document:) %>"
         class="collaborative-texts-container editor-content">
      <%= decidim_sanitize decidim_rich_text(document.consolidated_body), { scrubber: Decidim::AdminInputScrubber.new } %>
    </div>

    <% if document.coauthorships.any? %>
      <div>
        <h5 class="h5 my-4"><%= t("decidim.collaborative_texts.documents.show.contributors") %></h5>
        <%= cell "decidim/coauthorships", document, context_actions: [:date] %>
      </div>
    <% end %>
  </section>
<% end %>

<% append_javascript_pack_tag("decidim_collaborative_texts") %>
<% append_stylesheet_pack_tag("decidim_collaborative_texts") %>
