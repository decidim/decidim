<% @proposals.each do |proposal| %>
  (function() {
    var $proposalVotesCount = $('#proposal-<%= proposal.id %>-votes-count');

    if($proposalVotesCount[0]) {
      morphdom($proposalVotesCount[0], '<%= j(render partial: "decidim/proposals/proposals/votes_count", locals: { proposal:, from_proposals_list: @from_proposals_list }).strip.html_safe %>');
    }

    var $proposalVoteButton = $('#proposal-<%= proposal.id %>-vote-button');

    if($proposalVoteButton[0]) {
      morphdom($proposalVoteButton[0], '<%= j(render partial: "decidim/proposals/proposals/vote_button", locals: { proposal:, from_proposals_list: @from_proposals_list }).strip.html_safe %>');
    }
  })();
<% end %>

<% if vote_limit_enabled? %>
  (function() {
    var $remainingVotesCount = $('#remaining-votes-count');
    var $notVotedButtons = $('.card__button.button').not('.success');
    var $proposalVotingRules = $('#proposal-voting-rules')
    var $remainingVotesNotification = $('#remaining-votes-notification')
    var $successVoteNotification = $('#success-proposal-vote')
    var $exitProposalModal = $('#exit-proposal-notification')

    if(!$remainingVotesCount[0]) { return; }

    morphdom($remainingVotesCount[0], '<%= j(render partial: "decidim/proposals/proposals/remaining_votes_count").strip.html_safe %>');

    <% if @voted_proposals ? @voted_proposals.include?(@proposal.id) : @proposal.voted_by?(current_user) %>
      if($remainingVotesNotification[0]) {
        morphdom($remainingVotesNotification[0], '<%= j(render partial: "decidim/proposals/proposals/remaining_votes_notification").strip.html_safe %>');
      }
    <% end %>

    <% if remaining_votes_count_for(current_user) == 0 %>
      $notVotedButtons.attr('disabled', true);
      $notVotedButtons.val('<%= t("decidim.proposals.proposals.vote_button.no_votes_remaining") %>');

      if($successVoteNotification[0]) {
        morphdom($successVoteNotification[0], '<%= j(render partial: "decidim/proposals/proposals/notification_alert_box").strip.html_safe %>');
      }

      if($proposalVotingRules[0]) {
        morphdom($proposalVotingRules[0], '<%= j(render partial: "decidim/proposals/proposals/proposal_voting_rules").strip.html_safe %>');
      }
    <% else %>
      $notVotedButtons.attr('disabled', false);
      $notVotedButtons.val('<%= t("decidim.proposals.proposals.vote_button.vote") %>');

      if($exitProposalModal[0]) {
        morphdom($exitProposalModal[0], '<%= j(render partial: "decidim/proposals/proposals/exit_modal").strip.html_safe %>');
      }
    <% end %>
  }());
<% end %>

<% if show_voting_rules? %>
  (function() {
    var $votingRules = $('.voting-rules');
    if(!$votingRules[0]) { return; }
    morphdom($votingRules[0], '<%= j(render partial: "decidim/proposals/proposals/voting_rules").strip.html_safe %>');
  }());
<% end %>
