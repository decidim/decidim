<div class="form__wrapper">
  <div class="card" data-component="accordion" id="accordion-<%= title %>">
    <div class="card-divider">
      <button class="card-divider-button" data-open="true" data-controls="panel-<%= title %>" type="button">
        <%= icon "arrow-right-s-line" %>
        <h2 class="card-title" id="<%= title %>">
          <%= title %>
        </h2>
      </button>
    </div>

    <div id="panel-<%= title %>" class="card-section">
      <div class="row column">
        <%= form.translated :text_field, :name, autofocus: true %>
      </div>
      <div class="row column">
        <%= form.number_field :weight %>
      </div>
    </div>
  </div>
  <% if form.object.settings? %>
    <div class="card" data-component="accordion" id="accordion-<%= t ".global_settings" %>">
      <div class="card-divider">
        <button class="card-divider-button" data-open="true" data-controls="panel-<%= t ".global_settings" %>" type="button">
          <%= icon "arrow-right-s-line" %>
          <h2 class="card-title" id="<%= t ".global_settings" %>">
            <%= t ".global_settings" %>
          </h2>
        </button>
      </div>

      <div id="panel-<%= t ".global_settings" %>" class="card-section">
        <div class="row column">
          <fieldset class="global-settings">
            <div class="card-section">
              <%= form.fields_for :settings, form.object.settings do |settings_fields| %>
                <%= render partial: "decidim/admin/components/settings_fields",
                           locals: {
                             form: settings_fields,
                             manifest: form.object.manifest,
                             settings_name: :global,
                             tabs_prefix: "global-settings"
                           } %>
              <% end %>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  <% end %>
  <% if current_participatory_space.has_steps? %>
    <div class="card" data-component="accordion" id="accordion-<%= t '.step_settings' %>">
      <div class="card-divider">
        <button class="card-divider-button" data-open="true" data-controls="panel-<%= t '.step_settings' %>" type="button">
          <%= icon "arrow-right-s-line" %>
          <h2 class="card-title" id="<%= t '.step_settings' %>">
            <%= t '.step_settings' %>
          </h2>
        </button>
      </div>

      <div id="panel-<%= t '.step_settings' %>" class="card-section">
        <div class="row column">
          <fieldset class="step-settings">
            <div class="card-section">
              <% current_participatory_space.steps.each do |step| %>
                <fieldset class="step-settings-<%= step.id %>">
                  <legend><%= step.position + 1 %>. <%= translated_attribute step.title %></legend>
                  <% step_settings = form.object.step_settings[step.id.to_s] %>

                  <%= form.fields_for :step_settings, nil do |settings_fields| %>
                    <%= settings_fields.fields_for step.id.to_s, step_settings do |settings_fields| %>
                      <%= render partial: "decidim/admin/components/settings_fields",
                                 locals: {
                                   form: settings_fields,
                                   manifest: form.object.manifest,
                                   settings_name: :step,
                                   tabs_prefix: "step-#{step.id}-settings"
                                 } %>
                    <% end %>
                  <% end %>
                </fieldset>
              <% end %>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  <% elsif form.object.default_step_settings? %>
    <div class="card"  data-component="accordion" id="accordion-<%= t ".default_step_settings" %>">
      <div class="card-divider">
        <button class="card-divider-button" data-open="true" data-controls="panel-<%= t ".default_step_settings" %>" type="button">
          <%= icon "arrow-right-s-line" %>
          <h2 class="card-title" id="<%= t ".default_step_settings" %>">
            <%= t ".default_step_settings" %>
          </h2>
        </button>
      </div>

      <div id="panel-<%= t ".default_step_settings" %>" class="card-section">
        <div class="row column">
          <fieldset class="default-step-settings">
            <div class="card-section">
              <%= form.fields_for :default_step_settings, form.object.default_step_settings do |settings_fields| %>
                <%= render partial: "decidim/admin/components/settings_fields",
                           locals: {
                             form: settings_fields,
                             manifest: form.object.manifest,
                             settings_name: :step,
                             tabs_prefix: "default-step-settings"
                           } %>
              <% end %>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  <% end %>
  <% if component && component.persisted? && !component.published? %>
    <div class="card" data-component="accordion" id="accordion-<%= title %>">
      <div id="panel-<%= title %>" class="card-section">
        <div class="row column">
            <%= render partial: "decidim/admin/share_tokens/share_tokens", locals: { share_tokens: form.object.share_tokens } %>
        </div>
      </div>
    </div>
  <% end %>
</div>
